<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KRA Services - Tracker Wanga</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="/firebase.js"></script>
</head>
<body class="bg-slate-900 text-white font-sans">
  <main class="p-6 max-w-2xl mx-auto space-y-6">
    <h1 class="text-2xl font-bold text-green-400">üßæ KRA Services Request</h1>
    <p class="text-slate-300">Please fill in the following details to get assistance with your KRA service.</p>

    <form id="kraForm" class="space-y-4">
      <input required name="fullName" type="text" placeholder="Full Name" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />
      <input required name="phone" type="tel" placeholder="Phone Number (e.g. 07xxxxxxxx)" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />
      <input required name="kraPin" type="text" placeholder="KRA PIN" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />
      <input required name="kraPassword" type="text" placeholder="KRA Password (or type 'none')" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />
      <input required name="idNumber" type="text" placeholder="ID Number" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />

      <select required name="county" class="w-full p-2 rounded bg-slate-800 text-slate-300">
        <option value="">Select County</option>
        <option>Baringo</option>
        <option>Bomet</option>
        <option>Bungoma</option>
        <option>Busia</option>
        <option>Elgeyo Marakwet</option>
        <option>Embu</option>
        <option>Garissa</option>
        <option>Homa Bay</option>
        <option>Isiolo</option>
        <option>Kajiado</option>
        <option>Kakamega</option>
        <option>Kericho</option>
        <option>Kiambu</option>
        <option>Kilifi</option>
        <option>Kirinyaga</option>
        <option>Kisii</option>
        <option>Kisumu</option>
        <option>Kitui</option>
        <option>Kwale</option>
        <option>Laikipia</option>
        <option>Lamu</option>
        <option>Machakos</option>
        <option>Makueni</option>
        <option>Mandera</option>
        <option>Marsabit</option>
        <option>Meru</option>
        <option>Migori</option>
        <option>Mombasa</option>
        <option>Murang'a</option>
        <option>Nairobi</option>
        <option>Nakuru</option>
        <option>Nandi</option>
        <option>Narok</option>
        <option>Nyamira</option>
        <option>Nyandarua</option>
        <option>Nyeri</option>
        <option>Samburu</option>
        <option>Siaya</option>
        <option>Taita Taveta</option>
        <option>Tana River</option>
        <option>Tharaka Nithi</option>
        <option>Trans Nzoia</option>
        <option>Turkana</option>
        <option>Uasin Gishu</option>
        <option>Vihiga</option>
        <option>Wajir</option>
        <option>West Pokot</option>
      </select>

      <input name="job" type="text" placeholder="Current Job (or write 'none')" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />
      <input name="location" type="text" placeholder="Location (e.g. Nairobi)" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />
      <input name="postalCode" type="text" placeholder="Postal Code (optional)" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500" />
      <textarea name="extra" placeholder="Any additional info (optional)" class="w-full p-2 rounded bg-slate-800 placeholder-slate-500"></textarea>

      <div class="grid grid-cols-1 gap-3">
        <button type="button" class="bg-blue-500 text-black py-2 rounded" onclick="selectService('Filing kra nil returns only @150')">~Filing kra nil returns only @150</button>
        <button type="button" class="bg-blue-500 text-black py-2 rounded" onclick="selectService('income tax returns @250')">~income tax returns @250</button>
        <button type="button" class="bg-blue-500 text-black py-2 rounded" onclick="selectService('New kra pin application @300')">~New kra pin application @300</button>
        <button type="button" class="bg-blue-500 text-black py-2 rounded" onclick="selectService('Kra penalty/Waiver removal @400')">~Kra penalty/Waiver removal @400</button>
        <button type="button" class="bg-blue-500 text-black py-2 rounded" onclick="selectService('Lost kra pin retrieval @150')">~Lost kra pin retrieval @150</button>
        <button type="button" class="bg-blue-500 text-black py-2 rounded" onclick="selectService('kra email change @300')">~kra email change @300</button>
      </div>

      <textarea name="message" placeholder="Write a message or request..." class="w-full p-2 mt-4 rounded bg-slate-800 placeholder-slate-500"></textarea>

      <button type="submit" class="w-full bg-green-500 text-black py-2 rounded hover:bg-green-400">Submit Request</button>
    </form>

    <div id="successMsg" class="hidden text-green-400 font-semibold mt-4">
      ‚úÖ Submitted successfully. You will be contacted via WhatsApp.
    </div>

    <p class="text-xs text-slate-500 mt-6 border-t border-slate-700 pt-4">
      üîí Your information is private and not stored beyond service processing.<br>
      &copy; 2025 Tracker Wanga ‚Äî All rights reserved.
    </p>
  </main>

  <script type="module">
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { app } from '/firebase.js';

    const db = getDatabase(app);
    const form = document.getElementById('kraForm');
    const successMsg = document.getElementById('successMsg');

    function selectService(serviceText) {
      const currentMessage = form.message.value;
      form.message.value = currentMessage ? `${currentMessage}\n${serviceText}` : serviceText;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      try {
        await push(ref(db, 'kraRequests'), data);
        successMsg.classList.remove('hidden');
        form.reset();
      } catch (err) {
        alert("‚ùå Failed to submit. Try again later.");
        console.error(err);
      }
    });
  </script>
</body>
</html>
